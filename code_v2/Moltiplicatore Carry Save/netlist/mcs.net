*MOLTIPLICATORE CARRY SAVE

.option filetype=ascii
.INCLUDE ../lib/ST65LIKE_cell_library_v2020_1.net
.INCLUDE ../lib/16nm_HP.pm
.PARAM Lmin=16n
.PARAM Wmin=16n
.TRAN 0.1p 500p
.PARAM XXX=1

* x & y sono ingressi
.subckt AND_ARRAY_SUB 0 Vdd out0 out1 out2 out3 xin0 xin1 xin2 xin3 y XX = 1
	xand0 0 Vdd out0 xin0 y AND2_SUB XX=XXX
	xand1 0 Vdd out1 xin1 y AND2_SUB XX=XXX
	xand2 0 Vdd out2 xin2 y AND2_SUB XX=XXX
	xand3 0 Vdd out3 xin3 y AND2_SUB XX=XXX
.ends

*ai &bi (i=0..2) sono in Adder
.subckt ADD_ARRAY_SUB 0 Vdd sum0 sum1 sum2 Cout0 Cout1 Cout2 Cin0 Cin1 Cin2 a0 a1 a2 b0 b1 b2 XX = 1
	xadd0 0 Vdd sum0 cout0 cin0 a0 b0 FA_SUB XX = XXX
	xadd1 0 Vdd sum1 cout1 cin1 a1 b1 FA_SUB XX = XXX
	xadd2 0 Vdd sum2 cout2 cin2 a2 b2 FA_SUB XX = XXX
.ends

* Zi->Uscute moltiplicatore; c->Carry d'uscita; Mj,Nj->Fattori d'ingresso. 	-----	Con [i=0,..,7; j=0,..,3]
*xadd_array0 0 vdd z1 0sum1 0sum2 0cout0 0cout1 0cout2 0 0 0 1out0 1out1 1out2 0out1 0out2 0out3 ADD_ARRAY_SUB XX = XXX
*xadd_array1 0 vdd z2 1sum1 1sum2 1cout0 1cout1 1cout2 0cout0 0cout1 0cout2 2out0 2out1 2out2 0sum1 0sum2 1out3 ADD_ARRAY_SUB XX = XXX
*xadd_array2 0 vdd z3 2sum1 2sum2 2cout0 2cout1 2cout2 1cout0 1cout1 1cout2 3out0 3out1 3out2 1sum1 1sum2 2out3 ADD_ARRAY_SUB XX = XXX
*xadd_level3 0 vdd z4 z5 z6 3cout0 3cout1 z7 0 3cout0 3cout1 2cout0 2cout1 2cout2 2sum1 2sum2 3out3 ADD_ARRAY_SUB XX = XXX

.subckt MCS_SUB 0 Vdd z0 z1 z2 z3 z4 z5 z6 z7 xin0 xin1 xin2 xin3 yin0 yin1 yin2 yin3 XX = 1
	xand4_level0 0 Vdd z0 0out1 0out2 0out3 xin0 xin1 xin2 xin3 yin0 AND_ARRAY_SUB XX = XXX
	xand4_level1 0 Vdd 1out0 1out1 1out2 1out3 xin0 xin1 xin2 xin3 yin1 AND_ARRAY_SUB XX = XXX
	xadd_array0 0 Vdd z1 0sum1 0sum2 0cout0 0cout1 0cout2 0 0 0 0out3 ADD_ARRAY_SUB XX = XXX
	xand4_level2 0 Vdd 2out0 2out1 2out2 2out3 xin0 xin1 xin2 xin3 yin2 AND_ARRAY_SUB XX = XXX
	xadd_array1 0 Vdd z2 1sum1 1sum2 1cout0 1cout1 1cout2 0cout0 0cout1 0cout2 0 0 0 1out3 ADD_ARRAY_SUB XX = XXX
	xand4_level3 0 Vdd 3out0 3out1 3out2 3out3 xin0 xin1 xin2 xin3 yin3 AND_ARRAY_SUB XX = XXX
	xadd_array2 0 Vdd z3 2sum1 2sum2 2cout0 2cout1 2cout2 1cout0 1cout1 1cout2 0cout0 0cout1 0cout2 0 0 0 2out3 ADD_ARRAY_SUB XX = XXX
	xadd_array3 0 Vdd z4 z5 z6 3cout0 3cout1 3cout2 2cout0 2cout1 2cout2 1cout0 1cout1 1cout2 0cout0 0cout1 0cout2 0 0 0 3out3 ADD_ARRAY_SUB XX = XXX
.ends



xmcs 0 Vcc zz0 zz1 zz2 zz3 zz4 zz5 zz6 zz7 zx0 zx1 zx2 zx3 zy0 zy1 zy2 zy3  MCS_SUB XX = XXX
VinX3 XX3 0 0
VinX2 XX2 0 0
VinX1 XX1 0 0
VinX0 XX0 0 0
VinY3 XY3 0 0
VinY2 XY2 0 0
VinY1 XY1 0 0
VinY0 XY0 0 1
V_dd Vcc 0 1

.control
run
plot xz0
plot xz1
plot xz2
plot xz3
plot xz4
plot xz5
plot xz6
plot xz7

.endc
.end